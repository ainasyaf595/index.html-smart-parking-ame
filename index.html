<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Parking Online AME</title>

<style>
body {
  font-family: Poppins, Arial, sans-serif;
  background: #e5e5e5;
  margin:0; padding:20px; text-align:center;
}
h1 { font-size:2rem; margin-bottom:20px; color:#1f1f1f; }

/* PARKING AREA */
.parking-area {
  width:95%; max-width:950px;
  height:650px;
  margin:auto;
  background:#1f1f1f;
  border:4px solid #000;
  border-radius:12px;
  position:relative;
}

/* SLOT */
.slot {
  width:15%; height:30%;
  border:3px solid #fff; border-radius:6px;
  position:absolute; overflow:hidden;
  background:#4CAF50; /* default empty */
}

/* LABEL */
.slot-label {
  position:absolute; top:5px; width:100%;
  text-align:center; color:#fff; font-size:0.9rem; font-weight:bold;
}
.pillar {
  position:absolute; bottom:8px; right:5px;
  background:#fff; color:#000;
  border:2px solid #000; padding:3px 6px;
  border-radius:6px; font-size:0.8rem; font-weight:bold;
}

/* CAR ICON */
.car-icon {
  width:40%; height:60%;
  background:#fff;
  border-radius:6px;
  position:absolute;
  left:30%;
  top:100%;     /* Start outside slot */
  opacity:0;
}

/* SLOT WARNA */
.slot.occupied { background:#ff4d4d; }
.slot.empty { background:#4CAF50; }

/* ANIMASI MASUK KERETA */
@keyframes driveIn {
  0%   { top:120%; opacity:0; }
  40%  { top:80%;  opacity:1; }
  100% { top:20%;  opacity:1; }
}

/* ANIMASI KELUAR */
@keyframes driveOut {
  0%   { top:20%; opacity:1; }
  40%  { top:80%; opacity:1; }
  100% { top:120%; opacity:0; }
}

.slot.occupied .car-icon {
  animation: driveIn 1.1s ease forwards;
}
.slot.empty .car-icon {
  animation: driveOut 1.1s ease forwards;
}

/* JALAN UTAMA */
.road-vertical {
  position:absolute; bottom:0; left:50%;
  transform:translateX(-50%);
  width:15%; height:50%;
  background:#2c2c2c;
  border-left:4px dashed #fff;
  border-right:4px dashed #fff;
  z-index:1;
}
.road-horizontal {
  position:absolute; top:50%; left:0;
  width:100%; height:15%;
  background:#2c2c2c;
  border-top:4px dashed #fff;
  border-bottom:4px dashed #fff;
  z-index:1;
}

/* JALAN SAMBUNGAN KE SETIAP SLOT */
.lane {
  position:absolute;
  width:4%;
  height:12%;
  background:#2c2c2c;
  border-left:3px dashed #fff;
  border-right:3px dashed #fff;
  top:35%;
  z-index:0;
}

/* posisi setiap lane */
#lane1 { left:10%; }
#lane2 { left:30%; }
#lane3 { left:50%; }
#lane4 { left:70%; }
#lane5 { left:90%; }

/* STATUS BOX */
.status-box {
  position:fixed; right:20px; bottom:20px;
  padding:15px 25px; font-size:1.2rem;
  background:#1f1f1f; color:white;
  border:3px solid #000; border-radius:12px;
  font-weight:bold; box-shadow:0 4px 12px rgba(0,0,0,0.4);
}
</style>
</head>

<body>

<h1>SMART PARKING ONLINE AME</h1>

<div class="parking-area">

  <!-- SLOT ATAS -->
  <div id="slot1" class="slot" style="left:5%;  top:5%;"></div>
  <div id="slot2" class="slot" style="left:25%; top:5%;"></div>
  <div id="slot3" class="slot" style="left:45%; top:5%;"></div>
  <div id="slot4" class="slot" style="left:65%; top:5%;"></div>
  <div id="slot5" class="slot" style="left:85%; top:5%;"></div>

  <!-- LORONG MASUK KE PARKING -->
  <div id="lane1" class="lane"></div>
  <div id="lane2" class="lane"></div>
  <div id="lane3" class="lane"></div>
  <div id="lane4" class="lane"></div>
  <div id="lane5" class="lane"></div>

  <!-- JALAN UTAMA -->
  <div class="road-vertical"></div>
  <div class="road-horizontal"></div>

</div>

<div class="status-box">
  Petak Kosong: <span id="count">0</span> / 5
</div>

<script>
// CREATE LABEL, PILAR & KERETA
['slot1','slot2','slot3','slot4','slot5'].forEach(id=>{
  const div=document.getElementById(id);

  const label=document.createElement('div');
  label.className='slot-label';
  label.innerText=id.toUpperCase();
  div.appendChild(label);

  const pillar=document.createElement('span');
  pillar.className='pillar';
  pillar.innerText=id.replace("slot","");
  div.appendChild(pillar);

  const car=document.createElement('div');
  car.className='car-icon';
  div.appendChild(car);

  div.classList.add("empty"); // default
});

// FETCH DATA DARI FIREBASE
async function loadData(){
  try{
    const url="https://smart-parking-aee-default-rtdb.asia-southeast1.firebasedatabase.app/parking.json";
    const res=await fetch(url);
    const data=await res.json();

    Object.keys(data).forEach(id=>{
      const div=document.getElementById(id);
      if(!div) return;

      // tukar status
      if(data[id].status==='occupied'){
        div.classList.add('occupied');
        div.classList.remove('empty');
      } else {
        div.classList.add('empty');
        div.classList.remove('occupied');
      }
    });

    const count=Object.values(data).filter(x=>x.status==='empty').length;
    document.getElementById('count').innerText=count;

  }catch(err){
    console.error(err);
  }
}

setInterval(loadData,1000);
loadData();
</script>

</body>
</html>
